# pulumi-import-google-cloud-account-scraper

The repository contains a Python script that converts YAML generated by a [Config Connector](https://cloud.google.com/config-connector/docs/overview) [bulk export](https://cloud.google.com/config-connector/docs/how-to/import-export/bulk-export) into JSON suitable for use with the [`pulumi import`](https://www.pulumi.com/docs/guides/adopting/import/#bulk-import-operations) command. The code in this repository was written to accompany the blog post [Google Cloud: Bulk Importing Resources into Pulumi](https://pulumi.com/blog/google-cloud-pulumi-import-account-scraper).

This code should be considered proof-of-concept. A small percentage of Goolge Cloud resource types are supported. However, mapping new resource types is relatively straightforward. See the blog post for details.

## Usage

1. Install the Config Connector CLI ([instructions](https://cloud.google.com/config-connector/docs/how-to/import-export/overview#installing-config-connector)). Note that you do not need to a Kubernetes cluster or the Config Connector CRD - just the CLI.
1. Export your resources to a YAML file, e.g.:

    ```bash
    config-connector bulk-export --project YOUR-GOOGLE-CLOUD-PROJECT-ID --output config-connector-export.yaml --iam-format policymember --on-error continue
    ```

1. Clone this repository, initialize any virtual environments, download dependencies, and run the following command:

    ```bash
    cd config-connector-transform
    python3 main.py -i path/to/config-connector-export.yaml -o path/to/pulumi/target/project/pulumi-import.json -p YOUR-GOOGLE-CLOUD-PROJECT-ID
    ```

1. In your Pulumi project, bulk import the resources, e.g.:

    ```bash
    pulumi import -f pulumi-import.json -y -s dev -o index.ts
    ```

  The `pulumi import` command will automatically detect the correct language for your project, so substitute this value appropriately, e.g. `main.go`, `__main__.py`, etc.

## Contributing

Pull requests and issue submissions are welcome!

We don't have a comprehensive test bench yet, but including a sample Pulumi program to generate any infrastructure that your pull request addresses would be helpful. (If this repo generates sufficient interest we'll add a proper pipeline and integration tests.)
